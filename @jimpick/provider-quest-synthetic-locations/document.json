{
  "type": "notebook",
  "id": "41c5ca035d6c721b",
  "slug": "provider-quest-synthetic-locations",
  "trashed": false,
  "description": "",
  "likes": 0,
  "publish_level": "live",
  "forks": 0,
  "fork_of": null,
  "has_importers": false,
  "update_time": "2023-07-06T18:02:20.519Z",
  "first_public_version": 185,
  "paused_version": null,
  "publish_time": "2022-03-02T20:59:10.087Z",
  "publish_version": 191,
  "latest_version": 191,
  "thumbnail": "3d208ce1c34d8ac9ece082879de4db9054840c5f8a7e97ad71cbc700d448e7c2",
  "default_thumbnail": "3d208ce1c34d8ac9ece082879de4db9054840c5f8a7e97ad71cbc700d448e7c2",
  "roles": [],
  "sharing": null,
  "tags": [],
  "edits": [
    {
      "node_id": 75,
      "value": "For each of these providers without IP-based location date, we are now calculating \"Synthetic Locations\" which assign them to possible locations using clues from the blockchain data, proportions and probabilities."
    }
  ],
  "owner": {
    "id": "bda4505ba9a55ac8",
    "github_login": "jimpick",
    "avatar_url": "https://avatars.observableusercontent.com/avatar/e8813527082139d5411445010e72fd85f99b04a26355e795d0ea26765425d0cd",
    "login": "jimpick",
    "name": "Jim Pick",
    "bio": "Freelance Filecoin developer in Victoria, Canada",
    "home_url": "https://github.com/jimpick",
    "type": "individual",
    "tier": "public",
    "following_count": 0,
    "followers_count": 1,
    "following": false
  },
  "creator": {
    "id": "bda4505ba9a55ac8",
    "github_login": "jimpick",
    "avatar_url": "https://avatars.observableusercontent.com/avatar/e8813527082139d5411445010e72fd85f99b04a26355e795d0ea26765425d0cd",
    "login": "jimpick",
    "name": "Jim Pick",
    "bio": "Freelance Filecoin developer in Victoria, Canada",
    "home_url": "https://github.com/jimpick",
    "tier": "public",
    "following_count": 0,
    "followers_count": 1,
    "following": false
  },
  "authors": [
    {
      "id": "bda4505ba9a55ac8",
      "avatar_url": "https://avatars.observableusercontent.com/avatar/e8813527082139d5411445010e72fd85f99b04a26355e795d0ea26765425d0cd",
      "name": "Jim Pick",
      "login": "jimpick",
      "bio": "Freelance Filecoin developer in Victoria, Canada",
      "home_url": "https://github.com/jimpick",
      "github_login": "jimpick",
      "tier": "public",
      "approved": true,
      "description": "",
      "following_count": 0,
      "followers_count": 1,
      "following": false
    }
  ],
  "collections": [
    {
      "id": "242749e359cb986b",
      "type": "public",
      "slug": "provider-quest",
      "title": "Provider.Quest",
      "description": "Analytics and visualizations for the Filecoin network",
      "update_time": "2021-09-27T20:45:27.747Z",
      "pinned": false,
      "ordered": true,
      "custom_thumbnail": null,
      "default_thumbnail": "7f360024b03a87e10493b101b9df4cf7af2a618c7935c0e9c0e91c54a54c4c24",
      "thumbnail": "7f360024b03a87e10493b101b9df4cf7af2a618c7935c0e9c0e91c54a54c4c24",
      "listing_count": 31,
      "parent_collection_count": 1,
      "owner": {
        "id": "bda4505ba9a55ac8",
        "github_login": "jimpick",
        "avatar_url": "https://avatars.observableusercontent.com/avatar/e8813527082139d5411445010e72fd85f99b04a26355e795d0ea26765425d0cd",
        "login": "jimpick",
        "name": "Jim Pick",
        "bio": "Freelance Filecoin developer in Victoria, Canada",
        "home_url": "https://github.com/jimpick",
        "type": "individual",
        "tier": "public",
        "following_count": 0,
        "followers_count": 1,
        "following": false
      }
    }
  ],
  "files": [
    {
      "id": "30b14480498602b2fe0b464432b17d1d8735e6676200c99e288a10cedb27df2b5c6727009ba1d0491cbc4124f7e48a05affb3184ef67ca9e4d20329266857f31",
      "url": "https://static.observableusercontent.com/files/30b14480498602b2fe0b464432b17d1d8735e6676200c99e288a10cedb27df2b5c6727009ba1d0491cbc4124f7e48a05affb3184ef67ca9e4d20329266857f31",
      "download_url": "https://static.observableusercontent.com/files/30b14480498602b2fe0b464432b17d1d8735e6676200c99e288a10cedb27df2b5c6727009ba1d0491cbc4124f7e48a05affb3184ef67ca9e4d20329266857f31?response-content-disposition=attachment%3Bfilename*%3DUTF-8%27%27observed.png",
      "name": "observed.png",
      "create_time": "2022-04-27T17:57:57.601Z",
      "mime_type": "image/png",
      "status": "public",
      "size": 115506,
      "content_encoding": null,
      "private_bucket_id": null
    },
    {
      "id": "78c9b6083303b64c50fae9f56b3dc1de36f5bf2d7a6401ab59531a2b6ce24752d84bcc89ff11493cd08f9b00348d5ddbbcef9ef91b97235f8345d26ec97cbf8c",
      "url": "https://static.observableusercontent.com/files/78c9b6083303b64c50fae9f56b3dc1de36f5bf2d7a6401ab59531a2b6ce24752d84bcc89ff11493cd08f9b00348d5ddbbcef9ef91b97235f8345d26ec97cbf8c",
      "download_url": "https://static.observableusercontent.com/files/78c9b6083303b64c50fae9f56b3dc1de36f5bf2d7a6401ab59531a2b6ce24752d84bcc89ff11493cd08f9b00348d5ddbbcef9ef91b97235f8345d26ec97cbf8c?response-content-disposition=attachment%3Bfilename*%3DUTF-8%27%27synthetic.png",
      "name": "synthetic.png",
      "create_time": "2022-04-27T17:57:57.615Z",
      "mime_type": "image/png",
      "status": "public",
      "size": 140301,
      "content_encoding": null,
      "private_bucket_id": null
    }
  ],
  "comments": [],
  "commenting_lock": null,
  "suggestion_from": null,
  "suggestions_to": [],
  "version": 191,
  "title": "Documentation: Synthetic Locations [Provider.Quest]",
  "license": "apache-2.0",
  "copyright": "Copyright 2022 Jim Pick",
  "nodes": [
    {
      "id": 0,
      "value": "# Documentation: Synthetic Locations [Provider.Quest]",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 29,
      "value": "We have developed an algorithm to calculate \"synthetic locations\" for each provider on the Filecoin network.\n\nMany providers have advertised their IP addresses on the network so that clients can connect to them via a peer-to-peer protocol to make storage deals. We collect those IP addresses and use \"IP Geolocation\" databases (eg. [MaxMind GeoLite2](https://dev.maxmind.com/geoip/geolite2-free-geolocation-data?lang=en)) and additional services such as the [Baidu API](https://lbsyun.baidu.com/index.php?title=webapi/ip-api) (for China) to find the associated physical locations -- country, city, longitude, latitude, etc.\n\nSince many of the largest providers are solely focused on adding capacity to the network in order to gain block rewards, they have chosen not to advertise their IP addresses. These providers are not currently allowing the public to connect to them for deals. In the future, they may choose to make their capacity available for deals. Without the IP addresses, it is difficult to know exactly where they are!",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 75,
      "value": "For each of these providers without IP-based location date, we are now calculating \"Synthetic Locations\" which assign them to possible locations using clues from the blockchain data, proportions and probabilities.",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 79,
      "value": "These \"synthetic locations\" are essentially \"educated guesses\". For providers with no IP information, on an individual basis, they may be completely wrong. But for aggregated reporting across a large number of providers, they should reflect the true nature of the network with a useful degree of accuracy.",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 33,
      "value": "## Observed Locations vs. Synthetic Locations",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 38,
      "value": "Why do we want synthetic locations?\n\nThey are very useful when we want to do reporting against geographic regions.\n\nFor example, here is a snapshot of the Provider.Quest [Sunburst visualization](https://observablehq.com/@jimpick/provider-quest-zoomable-sunburst?datasource=Quality%20Adjusted%20Power&date=2022-04-26&chartfocus=&synthetic=false) using only observed location data (from 2022-04-26):",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 42,
      "value": "FileAttachment(\"observed.png\").image()",
      "pinned": false,
      "mode": "js",
      "data": null,
      "name": null
    },
    {
      "id": 47,
      "value": "As you can see, roughly two-thirds of the proven storage on the network is associated with providers for which we have observed no IP address information. Using only IP information, we don't know where they are, so we assign them to \"No Region\".",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 54,
      "value": "If we use the synthetic location data for the [Sunburst visualization](https://observablehq.com/@jimpick/provider-quest-zoomable-sunburst?datasource=Quality%20Adjusted%20Power&date=2022-04-25&chartfocus=&synthetic=true) instead, we have a more realistic picture:",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 63,
      "value": "FileAttachment(\"synthetic.png\").image()",
      "pinned": false,
      "mode": "js",
      "data": null,
      "name": null
    },
    {
      "id": 164,
      "value": "**Note:** *There are still some providers with \"No Region\" in this screenshot. These are just new providers and there is a temporary data interruption so we lack some data.*",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 59,
      "value": "In the real world, every provider is physically located somewhere, so this data is a better fit, even though we can't claim with perfect confidence that the allocation is 100% accurate.",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 84,
      "value": "## How do we collect IP addresses and get locations?",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 108,
      "value": "FIXME:\n\n* Describe on-chain multiaddrs vs. DHT\n* GeoIP database lookups\n* Problem with stale or fake IP listings",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 88,
      "value": "## Insight: Using Funding History",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 112,
      "value": "FIXME:\n\n* Forensic method\n* Miner creation requires funds\n* Tracing initial fund transfers\n* Lily/Sentinel\n* Building a \"funding tree\"",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 92,
      "value": "## Delegate Matching Algorithm",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 116,
      "value": "FIXME: \n\n* Funding Tree\n* Decorate leaves with IP location data\n* Power data\n* Backtracking\n* Consistent hashing\n* Delegates",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 96,
      "value": "## Region Mapping",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 120,
      "value": "FIXME:\n\n* multiple hierarchies\n  * regions used by Sunburst\n  * Country + State/Province used by Filecoin Green",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 100,
      "value": "## Feeds and Schemas",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 131,
      "value": "* Work-in-progress. Transitioning to new distribution mechanism.",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 182,
      "value": "Schema notes: In the `synthetic-*.json` files, we use the observable location/region if that is available, otherwise, we compute a \"delegate\" that copies the location/region data from another provider according to the algorithm. So any provider that is using synthetic location/regions will have a \"delegate\" record.",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 138,
      "value": "* AWS S3 Bucket:\n  * Top level URL: https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups\n  * Temporary solution to problem with Textile buckets + Cloudflare\n  * This will be deprecated once self-hosted solution is ready\n  * Published JSON files (updated regularly):\n    * Observed Regions/Locations\n      * \"Sunburst\" hierarchy \n        * [miner-region-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/miner-regions-latest.json) (only Regions, for reporting)\n        * [miner-locations-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/miner-locations-latest.json) (with Longitude/Latitude, for mapping)\n      * \"Country + State/Province\" hierarchy \n        * [provider-country-state-province-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/provider-country-state-province-latest.json) (only Regions, for reporting)\n        * [provider-country-state-province-locations-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/provider-country-state-province-locations-latest.json) (with Longitude/Latitude, for mapping)\n    * Synthetic Regions/Locations\n      * \"Sunburst\" hierarchy\n        * [synthetic-regions-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/synthetic-regions-latest.json) (only Regions, for reporting)\n        * [synthetic-locations-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/synthetic-locations-latest.json) (with Longitude/Latitude, for mapping)\n      * \"Country + State/Province\" hierarchy\n        * [synthetic-country-state-province-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/synthetic-country-state-province-latest.json) (only Regions, for reporting)\n        * [synthetic-country-state-province-locations-latest.json](https://provider-quest.s3.us-west-2.amazonaws.com/dist/geoip-lookups/synthetic-country-state-province-locations-latest.json) (with Longitude/Latitude, for mapping)\n* Textile Bucket:\n  * Top level URL: https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya\n  * We were using this initially. Auto-publishes to IPFS. Public gateway added Cloudflare protection due to abuse, but that broke using it as a data source via XHR from web pages. Using S3 as an interim fix.\n  * This will be deprecated once self-hosted solution is ready\n  * Published JSON files (updated regularly):\n    * Observed Regions/Locations\n      * \"Sunburst\" hierarchy \n        * [miner-region-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/miner-regions-latest.json) (only Regions, for reporting)\n        * [miner-locations-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/miner-locations-latest.json) (with Longitude/Latitude, for mapping)\n      * \"Country + State/Province\" hierarchy \n        * [provider-country-state-province-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/provider-country-state-province-latest.json) (only Regions, for reporting)\n        * [provider-country-state-province-locations-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/provider-country-state-province-locations-latest.json) (with Longitude/Latitude, for mapping)\n    * Synthetic Regions/Locations\n      * \"Sunburst\" hierarchy\n        * [synthetic-regions-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/synthetic-regions-latest.json) (only Regions, for reporting)\n        * [synthetic-locations-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/synthetic-locations-latest.json) (with Longitude/Latitude, for mapping)\n      * \"Country + State/Province\" hierarchy\n        * [synthetic-country-state-province-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/synthetic-country-state-province-latest.json) (only Regions, for reporting)\n        * [synthetic-country-state-province-locations-latest.json](https://hub.textile.io/thread/bafkwblbznyqkmqx5l677z3kjsslhxo2vbbqh6wluunvvdbmqattrdya/buckets/bafzbeibjg7kky45npdwnogui5ffla7dint62xpttvvlzrsbewlrfmbusya/synthetic-country-state-province-locations-latest.json) (with Longitude/Latitude, for mapping)\n\n* FIXME: Hierarchy JSON files\n* FIXME: Schema descriptions\n* Soon ... self-hosted IPFS with gateways + Estuary backups\n* Future\n  * Original observation data + intermediate data dumps\n  * Publish to Pando?\n",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 103,
      "value": "## Behind the Scenes",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 160,
      "value": "FIXME:\n\n* GitHub repos\n* Scanning from Observable notebooks\n* Lotus node / Lily data dumps\n* Kubernetes\n* Argo Workflows\n* Apache Spark\n* IPFS publishing",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 6,
      "value": "## Presentations",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 186,
      "value": "FIL Lisbon 2022:",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 188,
      "value": "<iframe width=\"1180\" height=\"484\" src=\"https://www.youtube.com/embed/7zjy7fJbrwI\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>",
      "pinned": false,
      "mode": "html",
      "data": {},
      "name": ""
    },
    {
      "id": 177,
      "value": "Filecoin Green Virtual Meetup - March 2022:",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 9,
      "value": "<iframe width=\"1180\" height=\"484\" src=\"https://www.youtube.com/embed/PyxSRV0UlFc\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>",
      "pinned": false,
      "mode": "html",
      "data": null,
      "name": ""
    },
    {
      "id": 18,
      "value": "## Backups",
      "pinned": false,
      "mode": "md",
      "data": null,
      "name": ""
    },
    {
      "id": 22,
      "value": "import {backups, backupNowButton} from '@jimpick/provider-quest-utils'",
      "pinned": false,
      "mode": "js",
      "data": null,
      "name": null
    },
    {
      "id": 25,
      "value": "backups()",
      "pinned": false,
      "mode": "js",
      "data": null,
      "name": null
    }
  ],
  "resolutions": []
}
